{"version":3,"file":"getresponse-form/view.js","mappings":"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","sources":["webpack://littledaisy-blocks/./src/getresponse-form/view.js"],"sourcesContent":["// Función para obtener los mensajes traducidos\nfunction getTranslatedMessages() {\n    const lang = document.documentElement.lang;\n\n    const messages = {\n        es: {\n            emailRequired: 'No olvides rellenar el campo e-mail.',\n            termsRequired: 'Si no aceptas los términos y condiciones no podremos seguir en contacto.',\n            suspiciousActivity: 'Se ha detectado actividad sospechosa. Inténtalo de nuevo.',\n            formTooFast: 'Error. Espera unos segundos y vuelve a enviar el formulario.',\n            recaptchaError: 'Error al validar el reCAPTCHA. Por favor, inténtalo de nuevo.',\n            validationError: 'Error al validar el envio del formulario',\n\n        },\n        ca: {\n            emailRequired: 'No oblidis omplir el camp e-mail.',\n            termsRequired: 'Si no acceptes els termes i condicions no podrem seguir en contacte.',\n            suspiciousActivity: 'S\\'ha detectat activitat sospitosa. Torna-ho a intentar.',\n            formTooFast: 'Error. Espera uns segons i torna a enviar el formulari.',\n            recaptchaError: 'Error en validar el reCAPTCHA. Si us plau, torneu-ho a intentar.',\n            validationError: 'Error en validar l\\'enviament del formulari'\n        }\n    };\n\n    return messages[lang] || messages['es'];\n}\n\nconst messages = getTranslatedMessages();\n\nfunction validateFormFields(form) {\n    const emailField = form.querySelector('input[name=\"email\"]');\n    const termsField = form.querySelector('input[name=\"terms-and-conditions\"]');\n    let errors = [];\n\n    if (!emailField || !emailField.value.trim()) {\n        errors.push(messages.emailRequired);\n    }\n\n    if (!termsField || !termsField.checked) {\n        errors.push(messages.termsRequired);\n    }\n\n    return errors;\n}\n\nfunction validateUserTraps(form) {\n    const honeypot = form.querySelector('input[name=\"user_comment\"]').value;\n    const startTime = parseInt(form.querySelector('input[name=\"start_time\"]').value, 10);\n    const currentTime = Date.now();\n    let errors = [];\n\n    if (honeypot) {\n        errors.push(messages.suspiciousActivity);\n    }\n\n    if ((currentTime - startTime) < 5000) {\n        errors.push(messages.formTooFast);\n    }\n\n    return errors;\n}\n\nasync function validateFieldsAndTrapsOnServer(formData) {\n    try {\n        const response = await fetch('/wp-json/custom/v1/validate-fields-and-traps', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(formData),\n        });\n\n        if (!response.ok) {\n            throw new Error('Error en la solicitud: ' + response.statusText);\n        }\n\n        const data = await response.json();\n        return data; // Devolver los datos completos de la respuesta\n    } catch (error) {\n        return { success: false, reason: messages.validationError };\n    }\n}\n\nasync function validateRecaptchaOnServer(token) {\n    try {\n        const response = await fetch('/wp-json/custom/v1/validate-recaptcha', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ token }),\n        });\n\n        if (!response.ok) {\n            throw new Error('Error en la solicitud: ' + response.statusText);\n        }\n\n        const data = await response.json();\n        return data; // Devolver los datos completos de la respuesta\n    } catch (error) {\n        return { success: false, reason: messages.recaptchaError };\n    }\n}\n\nfunction showError(message, form) {\n    // Crear un div para mostrar el mensaje de error\n    let errorDiv = form.querySelector('.form-error-message');\n    if (!errorDiv) {\n        errorDiv = document.createElement('div');\n        errorDiv.className = 'form-error-message';\n        form.appendChild(errorDiv);\n    }\n    errorDiv.textContent = message;\n\n    // Agregar clase de error a los campos relevantes\n    form.querySelectorAll('input').forEach(input => {\n        input.classList.add('error');\n    });\n}\n\nfunction clearError(form) {\n    // Borrar el div con el mensaje de error si existe\n    let errorDiv = form.querySelector('.form-error-message');\n    if (errorDiv) {\n        errorDiv.remove();\n    }\n\n    // Remover clase de error de los campos relevantes\n    form.querySelectorAll('input').forEach(input => {\n        input.classList.remove('error');\n    });\n}\n\ndocument.querySelectorAll('.g-recaptcha').forEach(button => {\n    button.addEventListener('click', function (event) {\n        event.preventDefault();\n        const activeSubmitButton = this;\n        const sitekey = activeSubmitButton.getAttribute('data-sitekey');\n        const uniqueId = activeSubmitButton.getAttribute('data-id');\n        const form = document.getElementById(uniqueId);\n\n        // Inicializar errores\n        let errors = [];\n\n        // Validar los campos del formulario\n        errors = errors.concat(validateFormFields(form));\n        if (errors.length > 0) {\n            showError(errors.join(' '), form);\n            return;\n        }\n\n        // Validar las trampas de usuario\n        errors = errors.concat(validateUserTraps(form));\n        if (errors.length > 0) {\n            showError(errors.join(' '), form);\n            return;\n        }\n        clearError(form); // Borrar mensajes de error anteriores\n        // Si todas las validaciones anteriores pasan, ejecutar reCAPTCHA\n        grecaptcha.execute(sitekey, { action: 'submit' }).then(function (token) {\n            window.onSubmit(token, activeSubmitButton);\n        });\n    });\n});\n\nwindow.onSubmit = function (token, activeSubmitButton, event) {\n    \n    if (activeSubmitButton) {\n        const uniqueId = activeSubmitButton.getAttribute('data-id');\n        const form = document.getElementById(uniqueId);\n        if (form) {\n            const pageName = window.location.pathname;\n            // Asignar el nombre de la página al campo oculto\n            const pageNameInput = form.querySelector('input[name=\"custom_url_seguimiento\"]');\n            if (pageNameInput) {\n                if(pageNameInput.value.includes('http') ){\n                    showError(messages.suspiciousActivity, form)\n                    return;\n                }else{\n                    pageNameInput.value = pageName;  // Actualizamos el valor\n                }      \n            }\n            // Validar campos del formulario y trampas\n            const errors = validateFormFields(form).concat(validateUserTraps(form));\n            if (errors.length > 0) {\n                showError(errors.join(' '), form);\n                return; // Evitar que se continúe si hay errores\n            }\n\n            const formData = new FormData(form);\n            formData.append('token', token);\n\n            // Convertir FormData a JSON\n            const formDataJSON = {};\n            formData.forEach((value, key) => {\n                formDataJSON[key] = value;\n            });\n            validateFieldsAndTrapsOnServer(formDataJSON).then(response => {\n                if (response.success) {\n                    validateRecaptchaOnServer(token).then(response => {\n                        if (response.success) {\n                            form.submit();\n                        } else {\n                            showError(response.reason, form);\n                        }\n                    }).catch(() => {\n                        showError(recaptchaError, form);\n                    });\n                } else {\n                    showError(validationError, form);\n                }\n            }).catch(() => {\n                showError(validationError, form);\n            });\n\n            // Valida el token de reCAPTCHA en el servidor\n\n        }\n    }\n};\ndocument.addEventListener('DOMContentLoaded', function () {\n    document.querySelectorAll('.lead-mail-form').forEach(form => {\n        const startTimeField = form.querySelector('input[name=\"start_time\"]');\n        if (startTimeField) {\n            startTimeField.value = Date.now(); // Establecer tiempo en milisegundos\n        }\n    });\n});"],"names":["getTranslatedMessages","lang","document","documentElement","messages","es","emailRequired","termsRequired","suspiciousActivity","formTooFast","recaptchaError","validationError","ca","validateFormFields","form","emailField","querySelector","termsField","errors","value","trim","push","checked","validateUserTraps","honeypot","startTime","parseInt","currentTime","Date","now","validateFieldsAndTrapsOnServer","formData","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","data","json","error","success","reason","validateRecaptchaOnServer","token","showError","message","errorDiv","createElement","className","appendChild","textContent","querySelectorAll","forEach","input","classList","add","clearError","remove","button","addEventListener","event","preventDefault","activeSubmitButton","sitekey","getAttribute","uniqueId","getElementById","concat","length","join","grecaptcha","execute","action","then","window","onSubmit","pageName","location","pathname","pageNameInput","includes","FormData","append","formDataJSON","key","submit","catch","startTimeField"],"sourceRoot":""}
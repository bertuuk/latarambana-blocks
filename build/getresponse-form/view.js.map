{"version":3,"file":"getresponse-form/view.js","mappings":";;;;;AAAA;AACA,SAASA,qBAAqBA,CAAA,EAAG;EAC7B,MAAMC,IAAI,GAAGC,QAAQ,CAACC,eAAe,CAACF,IAAI;EAE1C,MAAMG,QAAQ,GAAG;IACbC,EAAE,EAAE;MACAC,aAAa,EAAE,sCAAsC;MACrDC,aAAa,EAAE,0EAA0E;MACzFC,kBAAkB,EAAE,2DAA2D;MAC/EC,WAAW,EAAE,8DAA8D;MAC3EC,cAAc,EAAE;IACpB,CAAC;IACDC,EAAE,EAAE;MACAL,aAAa,EAAE,mCAAmC;MAClDC,aAAa,EAAE,sEAAsE;MACrFC,kBAAkB,EAAE,0DAA0D;MAC9EC,WAAW,EAAE,yDAAyD;MACtEC,cAAc,EAAE;IACpB;EACJ,CAAC;EAED,OAAON,QAAQ,CAACH,IAAI,CAAC,IAAIG,QAAQ,CAAC,IAAI,CAAC;AAC3C;AAEA,MAAMA,QAAQ,GAAGJ,qBAAqB,CAAC,CAAC;AAExC,SAASY,kBAAkBA,CAACC,IAAI,EAAE;EAC9B,MAAMC,UAAU,GAAGD,IAAI,CAACE,aAAa,CAAC,qBAAqB,CAAC;EAC5D,MAAMC,UAAU,GAAGH,IAAI,CAACE,aAAa,CAAC,oCAAoC,CAAC;EAC3E,IAAIE,MAAM,GAAG,EAAE;EAEf,IAAI,CAACH,UAAU,IAAI,CAACA,UAAU,CAACI,KAAK,CAACC,IAAI,CAAC,CAAC,EAAE;IACzCF,MAAM,CAACG,IAAI,CAAChB,QAAQ,CAACE,aAAa,CAAC;EACvC;EAEA,IAAI,CAACU,UAAU,IAAI,CAACA,UAAU,CAACK,OAAO,EAAE;IACpCJ,MAAM,CAACG,IAAI,CAAChB,QAAQ,CAACG,aAAa,CAAC;EACvC;EAEA,OAAOU,MAAM;AACjB;AAEA,SAASK,iBAAiBA,CAACT,IAAI,EAAE;EAC7B,MAAMU,QAAQ,GAAGV,IAAI,CAACE,aAAa,CAAC,4BAA4B,CAAC,CAACG,KAAK;EACvE,MAAMM,SAAS,GAAGC,QAAQ,CAACZ,IAAI,CAACE,aAAa,CAAC,0BAA0B,CAAC,CAACG,KAAK,EAAE,EAAE,CAAC;EACpF,MAAMQ,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;EAC9B,IAAIX,MAAM,GAAG,EAAE;EAEf,IAAIM,QAAQ,EAAE;IACVN,MAAM,CAACG,IAAI,CAAChB,QAAQ,CAACI,kBAAkB,CAAC;EAC5C;EAEA,IAAKkB,WAAW,GAAGF,SAAS,GAAI,IAAI,EAAE;IAClCP,MAAM,CAACG,IAAI,CAAChB,QAAQ,CAACK,WAAW,CAAC;EACrC;EAEA,OAAOQ,MAAM;AACjB;AAGA,eAAeY,yBAAyBA,CAACC,KAAK,EAAE;EAC5C,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,uCAAuC,EAAE;MAClEC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACL,cAAc,EAAE;MACpB,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAEP;MAAM,CAAC;IAClC,CAAC,CAAC;IAEF,IAAI,CAACC,QAAQ,CAACO,EAAE,EAAE;MACd,MAAM,IAAIC,KAAK,CAAC,yBAAyB,GAAGR,QAAQ,CAACS,UAAU,CAAC;IACpE;IAEA,MAAMC,IAAI,GAAG,MAAMV,QAAQ,CAACW,IAAI,CAAC,CAAC;IAClC,OAAOD,IAAI,CAAC,CAAC;EACjB,CAAC,CAAC,OAAOE,KAAK,EAAE;IACZ,OAAO;MAAEC,OAAO,EAAE,KAAK;MAAEC,MAAM,EAAEzC,QAAQ,CAACM;IAAe,CAAC;EAC9D;AACJ;AAEA,SAASoC,SAASA,CAACC,OAAO,EAAElC,IAAI,EAAE;EAC9B;EACA,IAAImC,QAAQ,GAAGnC,IAAI,CAACE,aAAa,CAAC,qBAAqB,CAAC;EACxD,IAAI,CAACiC,QAAQ,EAAE;IACXA,QAAQ,GAAG9C,QAAQ,CAAC+C,aAAa,CAAC,KAAK,CAAC;IACxCD,QAAQ,CAACE,SAAS,GAAG,oBAAoB;IACzCrC,IAAI,CAACsC,WAAW,CAACH,QAAQ,CAAC;EAC9B;EACAA,QAAQ,CAACI,WAAW,GAAGL,OAAO,GAAGlC,IAAI,CAACwC,EAAE;;EAExC;EACAxC,IAAI,CAACyC,gBAAgB,CAAC,OAAO,CAAC,CAACC,OAAO,CAACC,KAAK,IAAI;IAC5CA,KAAK,CAACC,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;EAChC,CAAC,CAAC;AACN;AAEA,SAASC,UAAUA,CAAC9C,IAAI,EAAE;EACtB;EACA,IAAImC,QAAQ,GAAGnC,IAAI,CAACE,aAAa,CAAC,qBAAqB,CAAC;EACxD,IAAIiC,QAAQ,EAAE;IACVA,QAAQ,CAACY,MAAM,CAAC,CAAC;EACrB;;EAEA;EACA/C,IAAI,CAACyC,gBAAgB,CAAC,OAAO,CAAC,CAACC,OAAO,CAACC,KAAK,IAAI;IAC5CA,KAAK,CAACC,SAAS,CAACG,MAAM,CAAC,OAAO,CAAC;EACnC,CAAC,CAAC;AACN;AAEA1D,QAAQ,CAACoD,gBAAgB,CAAC,cAAc,CAAC,CAACC,OAAO,CAACM,MAAM,IAAI;EACxDA,MAAM,CAACC,gBAAgB,CAAC,OAAO,EAAE,UAAUC,KAAK,EAAE;IAC9CA,KAAK,CAACC,cAAc,CAAC,CAAC;IACtB,MAAMC,kBAAkB,GAAG,IAAI;IAC/B,MAAMC,OAAO,GAAGD,kBAAkB,CAACE,YAAY,CAAC,cAAc,CAAC;IAC/D,MAAMC,QAAQ,GAAGH,kBAAkB,CAACE,YAAY,CAAC,SAAS,CAAC;IAC3D,MAAMtD,IAAI,GAAGX,QAAQ,CAACmE,cAAc,CAACD,QAAQ,CAAC;;IAE9C;IACA,IAAInD,MAAM,GAAG,EAAE;;IAEf;IACAA,MAAM,GAAGA,MAAM,CAACqD,MAAM,CAAC1D,kBAAkB,CAACC,IAAI,CAAC,CAAC;IAChD,IAAII,MAAM,CAACsD,MAAM,GAAG,CAAC,EAAE;MACnBzB,SAAS,CAAC7B,MAAM,CAACuD,IAAI,CAAC,GAAG,CAAC,EAAE3D,IAAI,CAAC;MACjC;IACJ;;IAEA;IACAI,MAAM,GAAGA,MAAM,CAACqD,MAAM,CAAChD,iBAAiB,CAACT,IAAI,CAAC,CAAC;IAC/C,IAAII,MAAM,CAACsD,MAAM,GAAG,CAAC,EAAE;MACnBzB,SAAS,CAAC7B,MAAM,CAACuD,IAAI,CAAC,GAAG,CAAC,EAAE3D,IAAI,CAAC;MACjC;IACJ;IACA8C,UAAU,CAAC9C,IAAI,CAAC,CAAC,CAAC;IAClB;IACA4D,UAAU,CAACC,OAAO,CAACR,OAAO,EAAE;MAAES,MAAM,EAAE;IAAS,CAAC,CAAC,CAACC,IAAI,CAAC,UAAU9C,KAAK,EAAE;MACpE+C,MAAM,CAACC,QAAQ,CAAChD,KAAK,EAAEmC,kBAAkB,CAAC;IAC9C,CAAC,CAAC;EACN,CAAC,CAAC;AACN,CAAC,CAAC;AAEFY,MAAM,CAACC,QAAQ,GAAG,UAAUhD,KAAK,EAAEmC,kBAAkB,EAAE;EACnD,IAAIA,kBAAkB,EAAE;IACpB,MAAMG,QAAQ,GAAGH,kBAAkB,CAACE,YAAY,CAAC,SAAS,CAAC;IAC3D,MAAMtD,IAAI,GAAGX,QAAQ,CAACmE,cAAc,CAACD,QAAQ,CAAC;IAC9C,IAAIvD,IAAI,EAAE;MACN,MAAMkE,QAAQ,GAAG,IAAIC,QAAQ,CAACnE,IAAI,CAAC;MACnCkE,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAEnD,KAAK,CAAC;;MAE/B;MACAD,yBAAyB,CAACC,KAAK,CAAC,CAAC8C,IAAI,CAAC7C,QAAQ,IAAI;QAC9C,IAAIA,QAAQ,CAACa,OAAO,EAAE;UAClB/B,IAAI,CAACqE,MAAM,CAAC,CAAC;QACjB,CAAC,MAAM;UACHpC,SAAS,CAACf,QAAQ,CAACc,MAAM,EAAEhC,IAAI,CAAC;QACpC;MACJ,CAAC,CAAC,CAACsE,KAAK,CAAC,MAAM;QACXrC,SAAS,CAAC,4DAA4D,EAAEjC,IAAI,CAAC;MACjF,CAAC,CAAC;IACN;EACJ;AACJ,CAAC;AACDX,QAAQ,CAAC4D,gBAAgB,CAAC,kBAAkB,EAAE,YAAY;EACtD5D,QAAQ,CAACoD,gBAAgB,CAAC,iBAAiB,CAAC,CAACC,OAAO,CAAC1C,IAAI,IAAI;IACzD,MAAMuE,cAAc,GAAGvE,IAAI,CAACE,aAAa,CAAC,0BAA0B,CAAC;IACrE,IAAIqE,cAAc,EAAE;MAChBA,cAAc,CAAClE,KAAK,GAAGS,IAAI,CAACC,GAAG,CAAC,CAAC,CAAC,CAAC;IACvC;EACJ,CAAC,CAAC;AACN,CAAC,CAAC,C","sources":["webpack://littledaisy-blocks/./src/getresponse-form/view.js"],"sourcesContent":["// Función para obtener los mensajes traducidos\nfunction getTranslatedMessages() {\n    const lang = document.documentElement.lang;\n\n    const messages = {\n        es: {\n            emailRequired: 'No olvides rellenar el campo e-mail.',\n            termsRequired: 'Si no aceptas los términos y condiciones no podremos seguir en contacto.',\n            suspiciousActivity: 'Se ha detectado actividad sospechosa. Inténtalo de nuevo.',\n            formTooFast: 'Error. Espera unos segundos y vuelve a enviar el formulario.',\n            recaptchaError: 'Error al validar el reCAPTCHA. Por favor, inténtalo de nuevo.'\n        },\n        ca: {\n            emailRequired: 'No oblidis omplir el camp e-mail.',\n            termsRequired: 'Si no acceptes els termes i condicions no podrem seguir en contacte.',\n            suspiciousActivity: 'S\\'ha detectat activitat sospitosa. Torna-ho a intentar.',\n            formTooFast: 'Error. Espera uns segons i torna a enviar el formulari.',\n            recaptchaError: 'Error en validar el reCAPTCHA. Si us plau, torneu-ho a intentar.'\n        }\n    };\n\n    return messages[lang] || messages['es'];\n}\n\nconst messages = getTranslatedMessages();\n\nfunction validateFormFields(form) {\n    const emailField = form.querySelector('input[name=\"email\"]');\n    const termsField = form.querySelector('input[name=\"terms-and-conditions\"]');\n    let errors = [];\n\n    if (!emailField || !emailField.value.trim()) {\n        errors.push(messages.emailRequired);\n    }\n\n    if (!termsField || !termsField.checked) {\n        errors.push(messages.termsRequired);\n    }\n\n    return errors;\n}\n\nfunction validateUserTraps(form) {\n    const honeypot = form.querySelector('input[name=\"user_comment\"]').value;\n    const startTime = parseInt(form.querySelector('input[name=\"start_time\"]').value, 10);\n    const currentTime = Date.now();\n    let errors = [];\n\n    if (honeypot) {\n        errors.push(messages.suspiciousActivity);\n    }\n\n    if ((currentTime - startTime) < 5000) {\n        errors.push(messages.formTooFast);\n    }\n\n    return errors;\n}\n\n\nasync function validateRecaptchaOnServer(token) {\n    try {\n        const response = await fetch('/wp-json/custom/v1/validate-recaptcha', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ token }),\n        });\n\n        if (!response.ok) {\n            throw new Error('Error en la solicitud: ' + response.statusText);\n        }\n\n        const data = await response.json();\n        return data; // Devolver los datos completos de la respuesta\n    } catch (error) {\n        return { success: false, reason: messages.recaptchaError };\n    }\n}\n\nfunction showError(message, form) {\n    // Crear un div para mostrar el mensaje de error\n    let errorDiv = form.querySelector('.form-error-message');\n    if (!errorDiv) {\n        errorDiv = document.createElement('div');\n        errorDiv.className = 'form-error-message';\n        form.appendChild(errorDiv);\n    }\n    errorDiv.textContent = message + form.id;\n\n    // Agregar clase de error a los campos relevantes\n    form.querySelectorAll('input').forEach(input => {\n        input.classList.add('error');\n    });\n}\n\nfunction clearError(form) {\n    // Borrar el div con el mensaje de error si existe\n    let errorDiv = form.querySelector('.form-error-message');\n    if (errorDiv) {\n        errorDiv.remove();\n    }\n\n    // Remover clase de error de los campos relevantes\n    form.querySelectorAll('input').forEach(input => {\n        input.classList.remove('error');\n    });\n}\n\ndocument.querySelectorAll('.g-recaptcha').forEach(button => {\n    button.addEventListener('click', function (event) {\n        event.preventDefault();\n        const activeSubmitButton = this;\n        const sitekey = activeSubmitButton.getAttribute('data-sitekey');\n        const uniqueId = activeSubmitButton.getAttribute('data-id');\n        const form = document.getElementById(uniqueId);\n\n        // Inicializar errores\n        let errors = [];\n\n        // Validar los campos del formulario\n        errors = errors.concat(validateFormFields(form));\n        if (errors.length > 0) {\n            showError(errors.join(' '), form);\n            return;\n        }\n\n        // Validar las trampas de usuario\n        errors = errors.concat(validateUserTraps(form));\n        if (errors.length > 0) {\n            showError(errors.join(' '), form);\n            return;\n        }\n        clearError(form); // Borrar mensajes de error anteriores\n        // Si todas las validaciones anteriores pasan, ejecutar reCAPTCHA\n        grecaptcha.execute(sitekey, { action: 'submit' }).then(function (token) {\n            window.onSubmit(token, activeSubmitButton);\n        });\n    });\n});\n\nwindow.onSubmit = function (token, activeSubmitButton) {\n    if (activeSubmitButton) {\n        const uniqueId = activeSubmitButton.getAttribute('data-id');\n        const form = document.getElementById(uniqueId);\n        if (form) {\n            const formData = new FormData(form);\n            formData.append('token', token);\n\n            // Valida el token de reCAPTCHA en el servidor\n            validateRecaptchaOnServer(token).then(response => {\n                if (response.success) {\n                    form.submit();\n                } else {\n                    showError(response.reason, form);\n                }\n            }).catch(() => {\n                showError('Error al validar reCAPTCHA. Por favor, inténtelo de nuevo.', form);\n            });\n        }\n    }\n};\ndocument.addEventListener('DOMContentLoaded', function () {\n    document.querySelectorAll('.lead-mail-form').forEach(form => {\n        const startTimeField = form.querySelector('input[name=\"start_time\"]');\n        if (startTimeField) {\n            startTimeField.value = Date.now(); // Establecer tiempo en milisegundos\n        }\n    });\n});"],"names":["getTranslatedMessages","lang","document","documentElement","messages","es","emailRequired","termsRequired","suspiciousActivity","formTooFast","recaptchaError","ca","validateFormFields","form","emailField","querySelector","termsField","errors","value","trim","push","checked","validateUserTraps","honeypot","startTime","parseInt","currentTime","Date","now","validateRecaptchaOnServer","token","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","data","json","error","success","reason","showError","message","errorDiv","createElement","className","appendChild","textContent","id","querySelectorAll","forEach","input","classList","add","clearError","remove","button","addEventListener","event","preventDefault","activeSubmitButton","sitekey","getAttribute","uniqueId","getElementById","concat","length","join","grecaptcha","execute","action","then","window","onSubmit","formData","FormData","append","submit","catch","startTimeField"],"sourceRoot":""}
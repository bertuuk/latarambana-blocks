(()=>{const e=function(){const e={es:{emailRequired:"No olvides rellenar el campo e-mail.",termsRequired:"Si no aceptas los términos y condiciones no podremos seguir en contacto.",suspiciousActivity:"Se ha detectado actividad sospechosa. Inténtalo de nuevo.",formTooFast:"Error. Espera unos segundos y vuelve a enviar el formulario.",recaptchaError:"Error al validar el reCAPTCHA. Por favor, inténtalo de nuevo.",validationError:"Error al validar el envio del formulario"},ca:{emailRequired:"No oblidis omplir el camp e-mail.",termsRequired:"Si no acceptes els termes i condicions no podrem seguir en contacte.",suspiciousActivity:"S'ha detectat activitat sospitosa. Torna-ho a intentar.",formTooFast:"Error. Espera uns segons i torna a enviar el formulari.",recaptchaError:"Error en validar el reCAPTCHA. Si us plau, torneu-ho a intentar.",validationError:"Error en validar l'enviament del formulari"}};return e[document.documentElement.lang]||e.es}();function t(t){const r=t.querySelector('input[name="email"]'),o=t.querySelector('input[name="terms-and-conditions"]');let n=[];return r&&r.value.trim()||n.push(e.emailRequired),o&&o.checked||n.push(e.termsRequired),n}function r(t){const r=t.querySelector('input[name="user_comment"]').value,o=parseInt(t.querySelector('input[name="start_time"]').value,10),n=Date.now();let a=[];return r&&a.push(e.suspiciousActivity),n-o<5e3&&a.push(e.formTooFast),a}function o(e,t){let r=t.querySelector(".form-error-message");r||(r=document.createElement("div"),r.className="form-error-message",t.appendChild(r)),r.textContent=e,t.querySelectorAll("input").forEach((e=>{e.classList.add("error")}))}document.querySelectorAll(".g-recaptcha").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const n=this,a=n.getAttribute("data-sitekey"),i=n.getAttribute("data-id"),c=document.getElementById(i);let s=[];s=s.concat(t(c)),s.length>0?o(s.join(" "),c):(s=s.concat(r(c)),s.length>0?o(s.join(" "),c):(function(e){let t=e.querySelector(".form-error-message");t&&t.remove(),e.querySelectorAll("input").forEach((e=>{e.classList.remove("error")}))}(c),grecaptcha.execute(a,{action:"submit"}).then((function(e){window.onSubmit(e,n)}))))}))})),window.onSubmit=function(n,a,i){if(a){const i=a.getAttribute("data-id"),c=document.getElementById(i);if(c){const a=window.location.pathname,i=c.querySelector('input[name="custom_url_seguimiento"]');if(i){if(i.value.includes("http"))return void o(e.suspiciousActivity,c);i.value=a}const s=t(c).concat(r(c));if(s.length>0)return void o(s.join(" "),c);const u=new FormData(c);u.append("token",n);const l={};u.forEach(((e,t)=>{l[t]=e})),async function(t){try{const e=await fetch("/wp-json/custom/v1/validate-fields-and-traps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Error en la solicitud: "+e.statusText);return await e.json()}catch(t){return{success:!1,reason:e.validationError}}}(l).then((t=>{t.success?async function(t){try{const e=await fetch("/wp-json/custom/v1/validate-recaptcha",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})});if(!e.ok)throw new Error("Error en la solicitud: "+e.statusText);return await e.json()}catch(t){return{success:!1,reason:e.recaptchaError}}}(n).then((e=>{e.success?c.submit():o(e.reason,c)})).catch((()=>{o(recaptchaError,c)})):o(validationError,c)})).catch((()=>{o(validationError,c)}))}}},document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".lead-mail-form").forEach((e=>{const t=e.querySelector('input[name="start_time"]');t&&(t.value=Date.now())}))}))})();